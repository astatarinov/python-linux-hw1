# python-linux-hw1
Решение домашнего задания 1 на курсе Python & Linux программы ФТИАД НИУ ВШЭ.

Файлы:
- **task.txt** - формулировка задания
- **parser.py** - исполняемый код (подробное описание представлено далее)
- **requirements.txt** - используемые библиотеки, не входящие в стадарнтный набор библиотек python

## Общее описание происходящего:

**parser.py** выполняет рекурсивное скачивание страниц сайта в формате `.html`, начиная с указанной url. 
Глубина поиска регулируется (параметр `depth`), т.е. в случае выбора глубины 1 будет получен только html файл исходной страницы. 
Если 2 - парсер найдет на ней все ссылки (ведущие на этот же сайт) и скачает страницы по этим адресам. 
Если 3 - будет искать на каждой странице из предыдущей итерации и т.д. 

Страницы по дублирующимся ссылкам будут скачаны только один раз. 
(Особенно актуально для сайтов с каким-либо полными оглавлениями на каждой странице).

Результат сохраняется следующим образом:
1. Создается файл **urls.txt** с парами "id ссылки" и "ссылка". id и ссылка разделены пробелом, каждая новая пара - на новой строке.
2. Создается директория **data/** с файлам вида **<id ссылки>.html**, в которую помещаются скачанные страницы. 

Предупреждение (!):
При повторном запуске скрипта существующие **urls.txt** и **data/** будут удалены. 

Если необходимо сохранить результаты предыдущего исполнения, укажите новую директорию
в параметре `path`.

### 1. Настройка окружения. 

В командной строке необходимо выполнить (построчно): 

```
> cd <your path to project dir>
> python -m venv ./project_venv
> source project_venv/bin/activate
> python -m pip -r install requirements.txt
```
Для ~~страдальцев~~ пользователей Windows:
```
> cd <your path to project dir>
> python -m venv ./project_venv
> cd project_venv/Scripts
> cd activate
> cd <your path to project dir>
> python -m pip -r install requirements.txt
```


### 2. Запуск программы

Скрипт запускается из командной строки:

```python3 parser.py [-h] [-d] [-s] [-p] url```

Параметры:
- `-h` - вызов помощи 
- `-d` - `depth`, `(type=int, default=1)`, глубина поиска. Принцип использования параметра описан выше.
- `-s` - `sleep`, `(type=float, default=1)`, время паузы в секундах `(type=float, default=1)`. Пауза используется во избежания блокировок со стороны сайта.
- `-p` - `path`, `(type=str, default='./')`, абсолютный или относительный (относительно директории проекта) путь до папки, куда пользователь желает сохранить результаты. По умолчанию файл **urls.txt** и папка **data/** будут созданы в директории проекта `(type=str, default='./')`.
- `url` - `URL`, `(type=str)`, стартовая ссылка для поиска в формате `https://...'

### 3. Потенциальные ошибки

При успешном подключении к сайту по переданной пользователем ссылке в терминал выводится 
`Initial page was reached successfully.`. В случае возникновения проблем на данном этапе будет 
выведена ошибка, скрипт остановится. В первую очередь стоит проверить корректность URL и подключение к Интернету (
также потенциально может повлиять использование VPN). 

При проблемах в подключении (`Request exception` или `Wrong status code`) к найденным страницам сайта на экран
также выводятся ошибка, URL и страница сайта, на которой URL была обнаружена. Процесс парсинга не будет остановлен,
но страница с ошибкой не сохранится.

В скрипте предполагается обработка относительных ссылок. Парсер создавался на базе 
скачивания страниц сайта https://younglinux.info/bash/linuxhistory и умеет работать с разными
типами ссылок на данном сайте. Тем не менее на данном этапе нельзя гарантировать 100% стабильную работу
на любых сторонних сайтах. В случае получения ссылки в непредусмотренном формате, она и родительская ссылка
будут выведены на экран.

## Пример использования:

Парсим уже упомянутый https://younglinux.info/bash/linuxhistory. 

Чтобы долго не ждать, укажу глубину 2 и паузы 0.5 секунды (у сайта нет защиты от парсинга).
Не хочу засорять директорию проекта, поэтому укажу путь для сохранения результатов 
`C:\Users\ruattar\Study\results` (сам проект лежит в `C:\Users\ruattar\Study\python-linux-hw1`).

(Прим. venv уже активирован)

```
python parser.py -d 2 -s 0.5 -p C:\Users\ruattar\Study\results "https://younglinux.info/bash/linuxhistory"
```

Процесс отработал без ошибок, поэтому в командной строке вижу только:

```
Initial page was reached successfully.
Starting parsing https://younglinux.info/bash/linuxhistory...

Results will be availble in C:\Users\ruattar\Study\results
Parsing process finished.
```

По указанной мной директории:
- в файле **urls.txt** ссылки в виде 
```
1 https://younglinux.info/bash/linuxhistory
2 https://younglinux.info/bash/man
3 https://younglinux.info/bash/findfiles
...
```
- в папке **data/** файлы
```
1.html
2.html
3.html
...
```







